@using System.Globalization
@using WebApplication1.Models
@model ObstacleData

@{
    ViewData["Title"] = "Overview";
    var lat = Model.Latitude?.ToString("0.######", CultureInfo.InvariantCulture);
    var lng = Model.Longitude?.ToString("0.######", CultureInfo.InvariantCulture);
}

<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
            <div class="alert alert-success rounded-4 shadow-sm" role="alert">
                <p class="mb-0">Your submission has been saved and is pending review.</p>
            </div>

            <div class="card shadow-sm rounded-4 mb-3">
                <div class="card-body p-4">
                    <h3 class="h5 mb-3">Obstacle Details</h3>
                    <dl class="row mb-0">
                        <dt class="col-5 col-md-4">Name</dt>
                        <dd class="col-7 col-md-8">@Model.ObstacleName</dd>

                        <!-- ✅ Ny rad for kategori -->
                        <dt class="col-5 col-md-4">Category</dt>
                        <dd class="col-7 col-md-8">@Model.Category?.Name</dd>

                        <dt class="col-5 col-md-4">Height</dt>
                        <dd class="col-7 col-md-8">
                            @(Model.ObstacleHeight != null
                                ? Model.ObstacleHeight?.ToString("0.##", CultureInfo.CurrentCulture) + " m"
                                : "")
                        </dd>

                        <dt class="col-5 col-md-4">Description</dt>
                        <dd class="col-7 col-md-8">@Model.ObstacleDescription</dd>

                        <dt class="col-5 col-md-4">Coordinates</dt>
                        <dd class="col-7 col-md-8">
                            @Model.Latitude?.ToString("0.######", CultureInfo.CurrentCulture),
                            @Model.Longitude?.ToString("0.######", CultureInfo.CurrentCulture)
                        </dd>

                        <dt class="col-5 col-md-4">Status</dt>
                        <dd class="col-7 col-md-8">
                            @switch (Model.Status)
                            {
                                case ReportStatus.Pending:
                                    <span class="badge text-bg-warning text-dark">Pending</span>
                                    break;
                                case ReportStatus.Approved:
                                    <span class="badge text-bg-success">Approved</span>
                                    break;
                                case ReportStatus.NotApproved:
                                    <span class="badge text-bg-danger">Not Approved</span>
                                    break;
                            }
                        </dd>
                    </dl>
                </div>
            </div>

            @if (!string.IsNullOrEmpty(Model.ReporterName))
            {
                <div class="card shadow-sm rounded-4 mb-3">
                    <div class="card-body p-4">
                        <h3 class="h6 mb-3">Reported By</h3>
                        <dl class="row mb-0">
                            <dt class="col-5 col-md-4">Name</dt>
                            <dd class="col-7 col-md-8">@Model.ReporterName</dd>

                            <dt class="col-5 col-md-4">Organization</dt>
                            <dd class="col-7 col-md-8">@Model.ReporterOrganization</dd>

                            <dt class="col-5 col-md-4">Submitted</dt>
                            <dd class="col-7 col-md-8">@Model.DateData.ToString("g", CultureInfo.CurrentCulture)</dd>
                        </dl>
                    </div>
                </div>
            }

            @if (Model.Latitude.HasValue && Model.Longitude.HasValue)
            {
                <div class="card shadow-sm rounded-4">
                    <div class="card-body p-0">
                        <div id="map-overview" style="height: 320px; border-radius: 0.75rem;"></div>
                    </div>
                </div>
            }

            <div class="d-grid gap-2 mt-3">
                <a asp-controller="Obstacle" asp-action="DataForm" class="btn btn-primary">Register another</a>
                <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary">Back to Home</a>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @if (Model.Latitude.HasValue && Model.Longitude.HasValue)
    {
        <script>
            const lat = parseFloat("@lat");
            const lng = parseFloat("@lng");
            const map2 = L.map('map-overview').setView([lat, lng], 14);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map2);
            L.marker([lat, lng]).addTo(map2);
        </script>
    }
}
